<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pramaan - PhD Scholar Attendance System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #4CAF50, #2196F3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }

        .app-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e3c72;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1e3c72;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .biometric-scanner {
            background: #f5f5f5;
            border: 3px dashed #ddd;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .biometric-scanner:hover {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .biometric-scanner.scanning {
            border-color: #FF9800;
            background: #fff3e0;
            animation: pulse 1s infinite;
        }

        .biometric-scanner.verified {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .fingerprint-icon {
            font-size: 64px;
            margin-bottom: 10px;
        }

        .attendance-history {
            margin-top: 30px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .history-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #666;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .zkp-info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1e3c72;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }

        .notification.error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #2196F3;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">P</div>
                <div>
                    <h1 class="app-title">Pramaan Attendance System</h1>
                    <p class="subtitle">Zero-Knowledge Proof Based Authentication for PhD Scholars</p>
                </div>
            </div>
            <div id="currentTime" style="font-size: 18px; font-weight: 600; color: #666;"></div>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalScholars">0</div>
                <div class="stat-label">Total Scholars</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="presentToday">0</div>
                <div class="stat-label">Present Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgHours">0</div>
                <div class="stat-label">Avg. Hours Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingVerification">0</div>
                <div class="stat-label">Pending Verification</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Registration Section -->
            <div class="section">
                <h2 class="section-title">
                    <span>👤</span> Scholar Registration
                </h2>
                
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('register')">New Registration</button>
                    <button class="tab" onclick="switchTab('attendance')">Mark Attendance</button>
                </div>

                <!-- Registration Tab -->
                <div id="registerTab" class="tab-content active">
                    <form id="registrationForm">
                        <div class="form-group">
                            <label>Scholar ID / Employee ID</label>
                            <input type="text" id="scholarId" placeholder="e.g., PHD2024001" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="name" placeholder="Enter full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="email" placeholder="scholar@university.edu" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Department</label>
                            <select id="department" required>
                                <option value="">Select Department</option>
                                <option value="CS">Computer Science</option>
                                <option value="EE">Electrical Engineering</option>
                                <option value="ME">Mechanical Engineering</option>
                                <option value="CE">Civil Engineering</option>
                                <option value="BT">Biotechnology</option>
                                <option value="CH">Chemistry</option>
                                <option value="PH">Physics</option>
                                <option value="MA">Mathematics</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Supervisor</label>
                            <input type="text" id="supervisor" placeholder="Dr. John Doe" required>
                        </div>
                        
                        <div class="biometric-scanner" id="regBiometricScanner" onclick="captureBiometric('register')">
                            <div class="fingerprint-icon">🔐</div>
                            <p>Click to Capture Biometric</p>
                            <small>Fingerprint / Face Recognition</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <span>✓</span> Register Scholar
                        </button>
                    </form>
                </div>

                <!-- Attendance Tab -->
                <div id="attendanceTab" class="tab-content">
                    <form id="attendanceForm">
                        <div class="form-group">
                            <label>Scholar ID / Employee ID</label>
                            <input type="text" id="attendanceScholarId" placeholder="e.g., PHD2024001" required>
                        </div>
                        
                        <div class="biometric-scanner" id="attBiometricScanner" onclick="captureBiometric('attendance')">
                            <div class="fingerprint-icon">👆</div>
                            <p>Click to Verify Identity</p>
                            <small>Place finger on scanner</small>
                        </div>
                        
                        <div class="zkp-info">
                            <strong>🔒 Privacy Protected:</strong> Your biometric data is converted to a zero-knowledge proof. 
                            The system verifies your identity without storing or exposing your actual biometric information.
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <span>✓</span> Mark Attendance
                        </button>
                    </form>
                </div>
            </div>

            <!-- Attendance History Section -->
            <div class="section">
                <h2 class="section-title">
                    <span>📊</span> Attendance Records
                </h2>
                
                <div class="form-group">
                    <label>Search by Scholar ID</label>
                    <input type="text" id="searchScholarId" placeholder="Enter Scholar ID to view history">
                </div>
                
                <div class="attendance-history">
                    <table class="history-table" id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Scholar ID</th>
                                <th>Name</th>
                                <th>Check In</th>
                                <th>Check Out</th>
                                <th>Hours</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- Records will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Simulated blockchain storage
        const blockchain = {
            scholars: {},
            attendance: [],
            zkProofs: {}
        };

        // Simulated biometric data
        let capturedBiometric = null;

        // Update current time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Tab switching
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            if (tab === 'register') {
                tabs[0].classList.add('active');
                document.getElementById('registerTab').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('attendanceTab').classList.add('active');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Simulate biometric capture
        async function captureBiometric(type) {
            const scanner = type === 'register' ? 
                document.getElementById('regBiometricScanner') : 
                document.getElementById('attBiometricScanner');
            
            scanner.classList.add('scanning');
            scanner.innerHTML = `
                <div class="loading"></div>
                <p>Scanning biometric...</p>
                <small>Please wait</small>
            `;
            
            // Simulate scanning delay
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Generate simulated biometric hash
            capturedBiometric = generateBiometricHash();
            
            scanner.classList.remove('scanning');
            scanner.classList.add('verified');
            scanner.innerHTML = `
                <div class="fingerprint-icon">✅</div>
                <p>Biometric Captured Successfully</p>
                <small>Data encrypted and ready</small>
            `;
            
            setTimeout(() => {
                scanner.classList.remove('verified');
                scanner.innerHTML = `
                    <div class="fingerprint-icon">${type === 'register' ? '🔐' : '👆'}</div>
                    <p>Click to ${type === 'register' ? 'Capture' : 'Verify'} Biometric</p>
                    <small>${type === 'register' ? 'Fingerprint / Face Recognition' : 'Place finger on scanner'}</small>
                `;
            }, 3000);
        }

        // Generate biometric hash (simulated)
        function generateBiometricHash() {
            return 'bio_' + Math.random().toString(36).substr(2, 9);
        }

        // Generate DID
        function generateDID(scholarId, biometricHash) {
            const combined = scholarId + biometricHash;
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return `did:pramaan:${Math.abs(hash).toString(16)}`;
        }

        // Generate ZK Proof
        function generateZKProof(did, biometricHash) {
            const proof = {
                commitment: `comm_${Math.random().toString(36).substr(2, 9)}`,
                challenge: `chal_${Math.random().toString(36).substr(2, 9)}`,
                response: `resp_${Math.random().toString(36).substr(2, 9)}`,
                timestamp: new Date().toISOString(),
                verified: true
            };
            blockchain.zkProofs[did] = proof;
            return proof;
        }

        // Register Scholar
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!capturedBiometric) {
                showNotification('Please capture biometric data first', 'error');
                return;
            }
            
            const scholarData = {
                scholarId: document.getElementById('scholarId').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                department: document.getElementById('department').value,
                supervisor: document.getElementById('supervisor').value,
                biometricHash: capturedBiometric,
                did: generateDID(document.getElementById('scholarId').value, capturedBiometric),
                registeredAt: new Date().toISOString()
            };
            
            // Store in blockchain
            blockchain.scholars[scholarData.scholarId] = scholarData;
            
            // Generate initial ZK proof
            generateZKProof(scholarData.did, scholarData.biometricHash);
            
            showNotification(`Scholar ${scholarData.name} registered successfully!`);
            document.getElementById('registrationForm').reset();
            capturedBiometric = null;
            updateStats();
        });

        // Mark Attendance
        document.getElementById('attendanceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const scholarId = document.getElementById('attendanceScholarId').value;
            const scholar = blockchain.scholars[scholarId];
            
            if (!scholar) {
                showNotification('Scholar not found. Please register first.', 'error');
                return;
            }
            
            if (!capturedBiometric) {
                showNotification('Please verify your biometric', 'error');
                return;
            }
            
            // Verify ZK Proof (simulated)
            const zkProof = blockchain.zkProofs[scholar.did];
            if (!zkProof || !zkProof.verified) {
                showNotification('Biometric verification failed', 'error');
                return;
            }
            
            // Check if already checked in today
            const today = new Date().toDateString();
            const existingAttendance = blockchain.attendance.find(
                a => a.scholarId === scholarId && new Date(a.checkIn).toDateString() === today
            );
            
            if (existingAttendance && !existingAttendance.checkOut) {
                // Check out
                existingAttendance.checkOut = new Date().toISOString();
                const hours = calculateHours(existingAttendance.checkIn, existingAttendance.checkOut);
                existingAttendance.hours = hours;
                showNotification(`Checked out successfully! Total hours: ${hours}`, 'success');
            } else if (existingAttendance && existingAttendance.checkOut) {
                showNotification('Already checked out for today', 'error');
            } else {
                // Check in
                const attendanceRecord = {
                    id: `att_${Date.now()}`,
                    scholarId: scholarId,
                    name: scholar.name,
                    department: scholar.department,
                    checkIn: new Date().toISOString(),
                    checkOut: null,
                    hours: 0,
                    zkProofId: zkProof.commitment,
                    verified: true
                };
                
                blockchain.attendance.push(attendanceRecord);
                showNotification(`Checked in successfully at ${new Date().toLocaleTimeString()}`, 'success');
            }
            
            document.getElementById('attendanceForm').reset();
            capturedBiometric = null;
            updateStats();
            updateAttendanceTable();
        });

        // Calculate hours between check-in and check-out
        function calculateHours(checkIn, checkOut) {
            const diff = new Date(checkOut) - new Date(checkIn);
            return (diff / (1000 * 60 * 60)).toFixed(2);
        }

        // Update statistics
        function updateStats() {
            const totalScholars = Object.keys(blockchain.scholars).length;
            const today = new Date().toDateString();
            const todayAttendance = blockchain.attendance.filter(
                a => new Date(a.checkIn).toDateString() === today
            );
            const presentToday = new Set(todayAttendance.map(a => a.scholarId)).size;
            
            let totalHours = 0;
            let completedSessions = 0;
            todayAttendance.forEach(a => {
                if (a.checkOut) {
                    totalHours += parseFloat(a.hours);
                    completedSessions++;
                }
            });
            
            const avgHours = completedSessions > 0 ? (totalHours / completedSessions).toFixed(1) : '0';
            const pendingCheckouts = todayAttendance.filter(a => !a.checkOut).length;
            
            document.getElementById('totalScholars').textContent = totalScholars;
            document.getElementById('presentToday').textContent = presentToday;
            document.getElementById('avgHours').textContent = avgHours;
            document.getElementById('pendingVerification').textContent = pendingCheckouts;
        }

        // Update attendance table
        function updateAttendanceTable() {
            const searchId = document.getElementById('searchScholarId').value;
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            const records = searchId ? 
                blockchain.attendance.filter(a => a.scholarId.includes(searchId)) :
                blockchain.attendance.slice(-10).reverse();
            
            records.forEach(record => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(record.checkIn).toLocaleDateString()}</td>
                    <td>${record.scholarId}</td>
                    <td>${record.name}</td>
                    <td>${new Date(record.checkIn).toLocaleTimeString()}</td>
                    <td>${record.checkOut ? new Date(record.checkOut).toLocaleTimeString() : '-'}</td>
                    <td>${record.hours || '-'}</td>
                    <td>
                        <span class="status-badge ${record.checkOut ? 'status-success' : 'status-pending'}">
                            ${record.checkOut ? 'Completed' : 'In Progress'}
                        </span>
                    </td>
                `;
            });
        }

        // Search functionality
        document.getElementById('searchScholarId').addEventListener('input', updateAttendanceTable);

        // Initialize with sample data
        function initializeSampleData() {
            // Sample scholars
            const sampleScholars = [
                {
                    scholarId: 'PHD2024001',
                    name: 'Rahul Sharma',
                    email: 'rahul.sharma@university.edu',
                    department: 'CS',
                    supervisor: 'Dr. Amit Kumar'
                },
                {
                    scholarId: 'PHD2024002',
                    name: 'Priya Patel',
                    email: 'priya.patel@university.edu',
                    department: 'EE',
                    supervisor: 'Dr. Sneha Gupta'
                }
            ];
            
            sampleScholars.forEach(scholar => {
                const biometric = generateBiometricHash();
                const did = generateDID(scholar.scholarId, biometric);
                blockchain.scholars[scholar.scholarId] = {
                    ...scholar,
                    biometricHash: biometric,
                    did: did,
                    registeredAt: new Date().toISOString()
                };
                generateZKProof(did, biometric);
            });
            
            // Sample attendance
            const now = new Date();
            blockchain.attendance.push({
                id: 'att_sample1',
                scholarId: 'PHD2024001',
                name: 'Rahul Sharma',
                department: 'CS',
                checkIn: new Date(now - 3 * 60 * 60 * 1000).toISOString(),
                checkOut: new Date(now - 30 * 60 * 1000).toISOString(),
                hours: '2.50',
                zkProofId: 'comm_sample1',
                verified: true
            });
            
            updateStats();
            updateAttendanceTable();
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initializeSampleData();
        });
    </script>
</body>
</html>